# 데이터분석 프로젝트 - 가계부 앱

> **🎯 프로젝트 목표**: Streamlit, pandas, matplotlib을 활용하여 실용적인 가계부 웹 애플리케이션을 완성합니다!

```table-of-contents
```

---

## 📋 프로젝트 개요

### 주요 기능
1. ✅ 수입/지출 내역 추가
2. ✅ 실시간 요약 통계 (수입, 지출, 잔액)
3. ✅ 데이터 필터링 및 정렬
4. ✅ 시각화 (차트)
5. ✅ CSV 파일 업로드/다운로드

### 사용 기술
- **Streamlit**: 웹 앱 프레임워크
- **pandas**: 데이터 처리
- **matplotlib**: 데이터 시각화
- **datetime**: 날짜/시간 처리

---

## 💰 가계부 웹 앱 - 전체 코드

**동작 예시**:
```
┌─────────────────────────────┐
│        간단 가계부           │
├─────────────────────────────┤
│ 분류: [지출 ▼]               │
│ 내역: [점심 식사_________]    │
│ 금액: [8000_____________]    │
│          [추가]             │
├─────────────────────────────┤
│ 수입: 500,000원             │
│ 지출: 358,000원             │
│ 잔액: 142,000원             │
├─────────────────────────────┤
│ 2025-01-15 | 지출 | 점심... │
│ 2025-01-14 | 수입 | 월급... │
│ 2025-01-13 | 지출 | 교통... │
└─────────────────────────────┘
```

**완성 코드** (`budget_app.py`):
```python
import streamlit as st
import pandas as pd
from datetime import datetime
import matplotlib.pyplot as plt

# 한글 폰트 설정
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

# 페이지 설정
st.set_page_config(page_title="간단 가계부", page_icon="💰", layout="wide")

st.title("💰 간단 가계부")

# 데이터 초기화
if 'budget_data' not in st.session_state:
    st.session_state.budget_data = pd.DataFrame(
        columns=["날짜", "분류", "내역", "금액"]
    )

# 사이드바: 입력 폼
with st.sidebar:
    st.header("📝 내역 추가")

    category = st.selectbox("분류", ["지출", "수입"])
    detail = st.text_input("내역", placeholder="예: 점심 식사")
    amount = st.number_input("금액", min_value=0, step=1000, value=0)

    if st.button("➕ 추가", use_container_width=True):
        if detail and amount > 0:
            # 지출은 음수로 저장
            final_amount = -amount if category == "지출" else amount

            new_row = pd.DataFrame([{
                "날짜": datetime.now().strftime("%Y-%m-%d %H:%M"),
                "분류": category,
                "내역": detail,
                "금액": final_amount
            }])

            st.session_state.budget_data = pd.concat(
                [st.session_state.budget_data, new_row],
                ignore_index=True
            )

            st.success("✅ 추가되었습니다!")
            st.balloons()
        else:
            st.error("⚠️ 모든 항목을 입력해주세요!")

    st.divider()

    # CSV 업로드
    st.subheader("📤 데이터 불러오기")
    uploaded_file = st.file_uploader("CSV 파일 업로드", type=['csv'])
    if uploaded_file is not None:
        st.session_state.budget_data = pd.read_csv(uploaded_file)
        st.success("✅ 파일이 업로드되었습니다!")

# 메인 영역
df = st.session_state.budget_data

if len(df) > 0:
    # 요약 통계
    total = df["금액"].sum()
    income = df[df["금액"] > 0]["금액"].sum()
    expense = abs(df[df["금액"] < 0]["금액"].sum())

    col1, col2, col3 = st.columns(3)
    col1.metric("💵 수입", f"{income:,.0f}원")
    col2.metric("💸 지출", f"{expense:,.0f}원", delta_color="inverse")
    col3.metric("💰 잔액", f"{total:,.0f}원",
                delta=f"{total:,.0f}원",
                delta_color="normal" if total >= 0 else "inverse")

    st.divider()

    # 탭으로 구분
    tab1, tab2, tab3 = st.tabs(["📋 내역 목록", "📊 통계 분석", "💾 데이터 관리"])

    with tab1:
        st.subheader("📋 전체 내역")

        # 필터 옵션
        col1, col2 = st.columns(2)
        with col1:
            filter_category = st.selectbox(
                "분류 필터",
                ["전체", "수입", "지출"]
            )
        with col2:
            sort_order = st.selectbox(
                "정렬",
                ["최신순", "과거순", "금액 높은순", "금액 낮은순"]
            )

        # 필터 적용
        filtered_df = df.copy()
        if filter_category != "전체":
            filtered_df = filtered_df[filtered_df["분류"] == filter_category]

        # 정렬 적용
        if sort_order == "최신순":
            filtered_df = filtered_df.sort_values("날짜", ascending=False)
        elif sort_order == "과거순":
            filtered_df = filtered_df.sort_values("날짜", ascending=True)
        elif sort_order == "금액 높은순":
            filtered_df = filtered_df.sort_values("금액", ascending=False)
        elif sort_order == "금액 낮은순":
            filtered_df = filtered_df.sort_values("금액", ascending=True)

        # 표시용 데이터 가공
        display_df = filtered_df.copy()
        display_df["금액"] = display_df["금액"].apply(lambda x: f"{x:,.0f}원")

        st.dataframe(display_df, use_container_width=True, height=400)

        # 삭제 기능
        if st.button("🗑️ 전체 삭제", type="secondary"):
            st.session_state.budget_data = pd.DataFrame(
                columns=["날짜", "분류", "내역", "금액"]
            )
            st.rerun()

    with tab2:
        st.subheader("📊 통계 분석")

        if len(df) > 0:
            # 분류별 합계
            income_total = df[df["금액"] > 0]["금액"].sum()
            expense_total = abs(df[df["금액"] < 0]["금액"].sum())

            # 원 그래프
            fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 5))

            # 수입 vs 지출
            ax1.pie([income_total, expense_total],
                    labels=['수입', '지출'],
                    autopct='%1.1f%%',
                    colors=['', ''],
                    startangle=90)
            ax1.set_title('수입 vs 지출')

            # 일별 추이 (최근 7일)
            df_temp = df.copy()
            df_temp['날짜'] = pd.to_datetime(df_temp['날짜'])
            daily = df_temp.groupby(df_temp['날짜'].dt.date)['금액'].sum()
            daily = daily.tail(7)

            ax2.plot(daily.index, daily.values, marker='o', linewidth=2)
            ax2.set_title('최근 7일 추이')
            ax2.set_xlabel('날짜')
            ax2.set_ylabel('금액 (원)')
            ax2.grid(True, alpha=0.3)
            ax2.tick_params(axis='x', rotation=45)

            plt.tight_layout()
            st.pyplot(fig)

            # 통계 표
            st.write("### 📈 주요 통계")
            stats_df = pd.DataFrame({
                "항목": ["평균 수입", "평균 지출", "최대 수입", "최대 지출"],
                "금액": [
                    f"{df[df['금액'] > 0]['금액'].mean():,.0f}원" if len(df[df['금액'] > 0]) > 0 else "0원",
                    f"{abs(df[df['금액'] < 0]['금액'].mean()):,.0f}원" if len(df[df['금액'] < 0]) > 0 else "0원",
                    f"{df[df['금액'] > 0]['금액'].max():,.0f}원" if len(df[df['금액'] > 0]) > 0 else "0원",
                    f"{abs(df[df['금액'] < 0]['금액'].min()):,.0f}원" if len(df[df['금액'] < 0]) > 0 else "0원"
                ]
            })
            st.table(stats_df)

    with tab3:
        st.subheader("💾 데이터 관리")

        # CSV 다운로드
        if len(df) > 0:
            csv = df.to_csv(index=False).encode('utf-8-sig')
            st.download_button(
                label="📥 CSV 파일로 다운로드",
                data=csv,
                file_name=f"가계부_{datetime.now().strftime('%Y%m%d')}.csv",
                mime="text/csv",
            )

            # 엑셀 다운로드 (openpyxl 필요)
            st.info("💡 엑셀 파일로 저장하려면 pandas와 openpyxl이 필요합니다.")

        # 데이터 정보
        st.write("### 📊 데이터 정보")
        st.write(f"- 전체 거래 건수: {len(df)}건")
        st.write(f"- 수입 건수: {len(df[df['금액'] > 0])}건")
        st.write(f"- 지출 건수: {len(df[df['금액'] < 0])}건")
        st.write(f"- 기간: {df['날짜'].min()} ~ {df['날짜'].max()}")

else:
    st.info("👈 왼쪽 사이드바에서 내역을 추가해보세요!")

    # 샘플 데이터 생성
    if st.button("🎲 샘플 데이터로 시작하기"):
        sample_data = pd.DataFrame([
            {"날짜": "2025-01-15 12:00", "분류": "지출", "내역": "점심 식사", "금액": -8000},
            {"날짜": "2025-01-15 18:00", "분류": "지출", "내역": "교통비", "금액": -5000},
            {"날짜": "2025-01-16 09:00", "분류": "수입", "내역": "월급", "금액": 3000000},
            {"날짜": "2025-01-17 14:00", "분류": "지출", "내역": "쇼핑", "금액": -50000},
        ])
        st.session_state.budget_data = sample_data
        st.rerun()
```

---

## 📝 코드 설명

### 1. 페이지 설정
```python
st.set_page_config(
    page_title="간단 가계부",  # 브라우저 탭 제목
    page_icon="💰",            # 파비콘
    layout="wide"              # 넓은 레이아웃
)
```

### 2. 세션 상태 관리
```python
if 'budget_data' not in st.session_state:
    st.session_state.budget_data = pd.DataFrame(...)
```
- 앱 전체에서 데이터 유지
- 새로고침 시에도 데이터 보존

### 3. 사이드바 입력 폼
```python
with st.sidebar:
    # 입력 위젯들
    category = st.selectbox("분류", ["지출", "수입"])
    detail = st.text_input("내역")
    amount = st.number_input("금액")
```

### 4. 데이터 추가 로직
```python
# 지출은 음수로 저장
final_amount = -amount if category == "지출" else amount

# 새 행 추가
new_row = pd.DataFrame([{...}])
st.session_state.budget_data = pd.concat([df, new_row])
```

### 5. 요약 통계
```python
total = df["금액"].sum()               # 잔액
income = df[df["금액"] > 0]["금액"].sum()  # 수입
expense = abs(df[df["금액"] < 0]["금액"].sum())  # 지출
```

### 6. 탭 UI
```python
tab1, tab2, tab3 = st.tabs(["📋 내역", "📊 통계", "💾 관리"])

with tab1:
    # 내역 목록

with tab2:
    # 통계 차트

with tab3:
    # 데이터 관리
```

### 7. 데이터 필터링
```python
filtered_df = df[df["분류"] == filter_category]
```

### 8. 차트 생성
```python
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 5))
ax1.pie(...)  # 원 그래프
ax2.plot(...) # 선 그래프
st.pyplot(fig)
```

---

## 🚀 실행 방법

### 1. 파일 저장
코드를 `budget_app.py`로 저장합니다.

### 2. 필요한 패키지 설치
```bash
pip install streamlit pandas matplotlib
```

### 3. 앱 실행
```bash
streamlit run budget_app.py
```

### 4. 브라우저에서 확인
자동으로 브라우저가 열리며 `http://localhost:8501`로 접속됩니다.

---

## 💡 주요 기능 상세

### 1. 수입/지출 추가
- 분류 선택 (수입/지출)
- 내역 입력
- 금액 입력
- 자동으로 날짜/시간 기록

### 2. 요약 통계
- 💵 총 수입
- 💸 총 지출
- 💰 잔액 (수입 - 지출)

### 3. 내역 목록
- 필터링 (전체/수입/지출)
- 정렬 (최신순/과거순/금액순)
- 인터랙티브 테이블

### 4. 통계 분석
- 원 그래프: 수입 vs 지출 비율
- 선 그래프: 최근 7일 추이
- 통계 표: 평균, 최대값

### 5. 데이터 관리
- CSV 다운로드
- CSV 업로드
- 데이터 정보 확인
- 전체 삭제

---

## 🎨 확장 아이디어

### 1. 카테고리별 지출 분석
```python
# 내역에서 카테고리 추출 (예: "식비-점심")
df['카테고리'] = df['내역'].str.split('-').str[0]

# 카테고리별 집계
category_expense = df[df['금액'] < 0].groupby('카테고리')['금액'].sum()
```

### 2. 월별 예산 설정
```python
# 사이드바에 월별 예산 설정
budget = st.sidebar.number_input("월 예산", value=2000000)

# 예산 대비 지출 비율
budget_ratio = (expense / budget) * 100
st.metric("예산 사용률", f"{budget_ratio:.1f}%")
```

### 3. 개별 항목 삭제
```python
# 각 행에 삭제 버튼 추가
for idx, row in df.iterrows():
    col1, col2, col3, col4 = st.columns([2, 2, 2, 1])
    col1.write(row['날짜'])
    col2.write(row['내역'])
    col3.write(f"{row['금액']:,}원")
    if col4.button("삭제", key=f"del_{idx}"):
        df.drop(idx, inplace=True)
        st.session_state.budget_data = df
        st.rerun()
```

### 4. 데이터베이스 연동 (SQLite)
```python
import sqlite3

# DB 연결
conn = sqlite3.connect('budget.db')

# 데이터 저장
df.to_sql('transactions', conn, if_exists='replace', index=False)

# 데이터 읽기
df = pd.read_sql('SELECT * FROM transactions', conn)
```

### 5. 엑셀 다운로드
```python
from io import BytesIO

# 엑셀로 변환
buffer = BytesIO()
with pd.ExcelWriter(buffer, engine='openpyxl') as writer:
    df.to_excel(writer, index=False, sheet_name='가계부')

st.download_button(
    label="📥 엑셀 다운로드",
    data=buffer.getvalue(),
    file_name="가계부.xlsx",
    mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
)
```

---

## AI 활용 프롬프트 모음

**기능 추가**:
```
"이 가계부에 카테고리별 지출 분석 기능을 추가해줘"
"월별 예산 설정 기능을 추가하는 방법을 알려줘"
"지출 항목을 개별 삭제하는 기능을 추가해줘"
"엑셀 파일(.xlsx)로 다운로드 기능을 구현하는 방법을 알려줘"
```

**데이터 분석**:
```
"지출 패턴을 분석하는 기능을 추가해줘"
"이상 지출을 감지하는 알고리즘을 구현해줘"
"월별 지출 추이를 비교하는 차트를 추가해줘"
```

**사용성 개선**:
```
"다크모드를 추가하는 방법을 알려줘"
"날짜 범위로 데이터를 필터링하는 기능을 추가해줘"
"검색 기능을 추가해줘"
```

**데이터 영속성**:
```
"데이터베이스(SQLite)에 저장하는 방법을 알려줘"
"클라우드에 데이터를 자동 백업하는 방법을 알려줘"
```

---

## 🎓 프로젝트 학습 포인트

**pandas**:
- ✅ DataFrame 생성 및 조작
- ✅ 데이터 필터링 및 정렬
- ✅ 그룹별 집계 (sum, mean)
- ✅ CSV 읽기/쓰기

**matplotlib**:
- ✅ 원 그래프 (pie)
- ✅ 선 그래프 (plot)
- ✅ 서브플롯 (subplots)
- ✅ 한글 폰트 설정

**Streamlit**:
- ✅ 세션 상태 관리
- ✅ 사이드바 레이아웃
- ✅ 탭 UI
- ✅ 파일 업로드/다운로드
- ✅ 인터랙티브 위젯

**Python**:
- ✅ datetime 모듈
- ✅ 조건문 및 반복문
- ✅ 함수 활용

---

## 📚 추가 학습 자료

**Streamlit 공식 문서**:
- https://docs.streamlit.io

**Streamlit 갤러리** (예제 앱들):
- https://streamlit.io/gallery

**pandas 공식 문서**:
- https://pandas.pydata.org/docs/

**matplotlib 공식 문서**:
- https://matplotlib.org/

---

## 🎉 프로젝트 완성!

축하합니다! 데이터 분석 기술을 활용한 실용적인 웹 애플리케이션을 완성했습니다.

**배운 기술**:
- pandas를 사용한 데이터 처리
- matplotlib을 사용한 데이터 시각화
- Streamlit을 사용한 웹 앱 개발
- 실전 프로젝트 개발 경험

**다음 단계**:
1. 더 많은 기능 추가하기
2. 배포하기 (Streamlit Cloud)
3. 다른 사람과 공유하기
4. 새로운 프로젝트 시작하기

화이팅! 🚀
